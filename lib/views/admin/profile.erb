<!-- Admin Profile Management Page -->
<div class="row g-4">
  <!-- Profile Information Card -->
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="fas fa-user-circle me-2"></i>Profile Information
        </h5>
      </div>
      <div class="card-body">
        <!-- Success/Error Messages -->
        <% if session[:profile_success] %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i><%= session.delete(:profile_success) %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>

        <% if session[:profile_error] %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i><%= session.delete(:profile_error) %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        <% end %>

        <!-- Profile Update Form -->
        <form method="post" action="/admin/profile/update">
          <input type="hidden" name="csrf_token" value="<%= csrf_token %>">

          <div class="row g-3">
            <div class="col-md-6">
              <label for="name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="name" name="name"
                     value="<%= h(@current_admin.name || @current_admin.email) %>" required autocomplete="off">
            </div>

            <div class="col-md-6">
              <label for="email" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="email" name="email"
                     value="<%= h(@current_admin.email) %>" required autocomplete="off">
            </div>
          </div>

          <div class="mt-3">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Update Profile
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Password Change Card -->
    <div class="card shadow-sm mt-4">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">
          <i class="fas fa-lock me-2"></i>Change Password
        </h5>
      </div>
      <div class="card-body">
        <form method="post" action="/admin/profile/password">
          <input type="hidden" name="csrf_token" value="<%= csrf_token %>">

          <div class="row g-3">
            <div class="col-12">
              <label for="current_password" class="form-label">Current Password</label>
              <input type="password" class="form-control" id="current_password"
                     name="current_password" required autocomplete="off">
            </div>

            <div class="col-md-6">
              <label for="new_password" class="form-label">New Password</label>
              <input type="password" class="form-control" id="new_password"
                     name="new_password" required autocomplete="off">
            </div>

            <div class="col-md-6">
              <label for="confirm_password" class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="confirm_password"
                     name="confirm_password" required autocomplete="off">
            </div>
          </div>

          <div class="mt-3">
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-key me-2"></i>Change Password
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Security & Activity Sidebar -->
  <div class="col-lg-4">
    <!-- Account Status Card -->
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        <h6 class="mb-0">
          <i class="fas fa-shield-alt me-2"></i>Account Security
        </h6>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <span>Admin Status:</span>
          <span class="badge bg-success">Active</span>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <span>Two-Factor Auth:</span>
          <% if @has_2fa %>
            <span class="badge bg-success">
              <i class="fas fa-check me-1"></i>Enabled
            </span>
          <% else %>
            <span class="badge bg-warning">
              <i class="fas fa-exclamation me-1"></i>Disabled
            </span>
          <% end %>
        </div>

        <div class="mb-3">
          <span class="text-muted">Member since:</span><br>
          <small><%= @current_admin.created_at&.strftime('%B %d, %Y') || 'Unknown' %></small>
        </div>

        <div class="d-grid">
          <a href="/admin/profile/security" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-cog me-2"></i>Security Settings
          </a>
        </div>
      </div>
    </div>

    <!-- Quick 2FA Setup -->
    <% unless @has_2fa %>
    <div class="card shadow-sm mt-3">
      <div class="card-header bg-warning text-dark">
        <h6 class="mb-0">
          <i class="fas fa-exclamation-triangle me-2"></i>Security Recommendation
        </h6>
      </div>
      <div class="card-body">
        <p class="small mb-3">Enable two-factor authentication to secure your admin account.</p>

        <div class="d-grid gap-2">
          <a href="/admin/2fa/totp/setup" class="btn btn-outline-success btn-sm">
            <i class="fas fa-mobile-alt me-2"></i>Setup TOTP
          </a>
          <a href="/admin/2fa/webauthn/register" class="btn btn-outline-info btn-sm">
            <i class="fas fa-key me-2"></i>Add Security Key
          </a>
        </div>
      </div>
    </div>
    <% end %>

    <!-- Recent Activity -->
    <div class="card shadow-sm mt-3">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-history me-2"></i>Recent Activity
        </h6>
      </div>
      <div class="card-body">
        <% if @recent_logins && @recent_logins.any? %>
          <% @recent_logins.each do |login| %>
            <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
              <div>
                <small class="text-muted">Login</small><br>
                <small><%= login[:ip] || 'Unknown IP' %></small>
              </div>
              <small class="text-muted">
                <%= login[:created_at]&.strftime('%m/%d %H:%M') || 'Recently' %>
              </small>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted small mb-0">No recent activity to display.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Custom Profile Styles -->
<style>
.card {
  border: 1px solid rgba(0,0,0,.125);
  border-radius: 0.5rem;
}

.card-header {
  border-bottom: 1px solid rgba(0,0,0,.125);
}

.form-control:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}

.btn-outline-primary:hover,
.btn-outline-success:hover,
.btn-outline-info:hover {
  transform: translateY(-1px);
}

@media (max-width: 768px) {
  .col-lg-4 {
    margin-top: 1rem;
  }
}
</style>
