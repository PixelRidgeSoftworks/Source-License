<!-- Code Guide Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">Template Code Guide</h1>
        <p class="text-muted mb-0">Learn how to customize templates beyond the visual editor</p>
    </div>
    <div>
        <a href="/admin/customize" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Visual Editor
        </a>
    </div>
</div>

<!-- Navigation Pills -->
<ul class="nav nav-pills mb-4" id="guideTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button">
            <i class="fas fa-info-circle me-2"></i>Overview
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="structure-tab" data-bs-toggle="pill" data-bs-target="#structure" type="button">
            <i class="fas fa-sitemap me-2"></i>File Structure
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="helpers-tab" data-bs-toggle="pill" data-bs-target="#helpers" type="button">
            <i class="fas fa-tools me-2"></i>Helper Functions
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="customization-tab" data-bs-toggle="pill" data-bs-target="#customization" type="button">
            <i class="fas fa-palette me-2"></i>Custom Values
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="examples-tab" data-bs-toggle="pill" data-bs-target="#examples" type="button">
            <i class="fas fa-code me-2"></i>Examples
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="guideTabContent">
    <!-- Overview Tab -->
    <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <div class="row g-4">
            <div class="col-12">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <i class="fas fa-lightbulb me-2"></i>
                        Getting Started with Template Customization
                    </div>
                    <div class="admin-card-body">
                        <p>Source License uses <strong>ERB (Embedded Ruby)</strong> templates for easy customization. You can:</p>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="border rounded p-3 h-100">
                                    <h6><i class="fas fa-paint-brush text-primary me-2"></i>Visual Customization</h6>
                                    <p class="small mb-0">Use the visual editor to customize colors, text, and layout without coding.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="border rounded p-3 h-100">
                                    <h6><i class="fas fa-code text-success me-2"></i>Template Editing</h6>
                                    <p class="small mb-0">Edit ERB files directly for complete control over structure and functionality.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Tip:</strong> Start with the visual editor for basic changes, then move to template editing for advanced customizations.
                        </div>
                        
                        <h6>What You Can Customize:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success me-2"></i>Page layouts and structure</li>
                            <li><i class="fas fa-check text-success me-2"></i>Colors, fonts, and styling</li>
                            <li><i class="fas fa-check text-success me-2"></i>Text content and messaging</li>
                            <li><i class="fas fa-check text-success me-2"></i>Navigation and footer</li>
                            <li><i class="fas fa-check text-success me-2"></i>Form layouts and functionality</li>
                            <li><i class="fas fa-check text-success me-2"></i>Admin interface styling</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- File Structure Tab -->
    <div class="tab-pane fade" id="structure" role="tabpanel">
        <div class="admin-card">
            <div class="admin-card-header">
                <i class="fas fa-folder me-2"></i>
                Template File Structure
            </div>
            <div class="admin-card-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <h6>Main Template Directory</h6>
                        <pre class="bg-light p-3 rounded"><code>views/
├── layouts/
│   ├── main_layout.erb      # Public site layout
│   └── admin_layout.erb     # Admin interface layout
├── partials/
│   ├── _navigation.erb      # Main navigation bar
│   └── _footer.erb          # Site footer
├── admin/
│   ├── login.erb           # Admin login page
│   ├── dashboard.erb       # Admin dashboard
│   ├── customize.erb       # Customization interface
│   └── code_guide.erb      # This page
├── errors/
│   ├── 404.erb             # 404 error page
│   └── 500.erb             # 500 error page
├── licenses/
│   └── lookup.erb          # License lookup page
└── index.erb               # Homepage</code></pre>
                    </div>
                    <div class="col-md-6">
                        <h6>Key Files to Customize</h6>
                        <div class="list-group">
                            <div class="list-group-item">
                                <strong>views/index.erb</strong>
                                <br><small class="text-muted">Homepage content and sections</small>
                            </div>
                            <div class="list-group-item">
                                <strong>views/layouts/main_layout.erb</strong>
                                <br><small class="text-muted">Overall site structure and CSS</small>
                            </div>
                            <div class="list-group-item">
                                <strong>views/partials/_navigation.erb</strong>
                                <br><small class="text-muted">Main navigation menu</small>
                            </div>
                            <div class="list-group-item">
                                <strong>views/partials/_footer.erb</strong>
                                <br><small class="text-muted">Site footer content</small>
                            </div>
                            <div class="list-group-item">
                                <strong>views/layouts/admin_layout.erb</strong>
                                <br><small class="text-muted">Admin interface styling</small>
                            </div>
                        </div>
                        
                        <div class="mt-3 p-3 bg-warning bg-opacity-10 rounded">
                            <small><i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <strong>Backup Important:</strong> Always backup your template files before making changes!</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Helper Functions Tab -->
    <div class="tab-pane fade" id="helpers" role="tabpanel">
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <i class="fas fa-magic me-2"></i>
                        Template Helpers
                    </div>
                    <div class="admin-card-body">
                        <h6>Basic Helpers</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Function</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>h(text)</code></td>
                                        <td>HTML escape text</td>
                                    </tr>
                                    <tr>
                                        <td><code>u(text)</code></td>
                                        <td>URL encode text</td>
                                    </tr>
                                    <tr>
                                        <td><code>truncate(text, length)</code></td>
                                        <td>Truncate text with ellipsis</td>
                                    </tr>
                                    <tr>
                                        <td><code>time_ago(date)</code></td>
                                        <td>Human readable time</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <h6 class="mt-4">UI Helpers</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Function</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>button(text, options)</code></td>
                                        <td>Generate styled button</td>
                                    </tr>
                                    <tr>
                                        <td><code>status_badge(status)</code></td>
                                        <td>Colored status badge</td>
                                    </tr>
                                    <tr>
                                        <td><code>format_currency(amount)</code></td>
                                        <td>Format currency display</td>
                                    </tr>
                                    <tr>
                                        <td><code>nav_link(text, path)</code></td>
                                        <td>Navigation link with active state</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <i class="fas fa-paint-brush me-2"></i>
                        Customization Helpers
                    </div>
                    <div class="admin-card-body">
                        <h6>Custom Value Helpers</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Function</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>custom(key, default)</code></td>
                                        <td>Get custom value</td>
                                    </tr>
                                    <tr>
                                        <td><code>custom_text(key, fallback)</code></td>
                                        <td>Get custom text</td>
                                    </tr>
                                    <tr>
                                        <td><code>custom_color(color, fallback)</code></td>
                                        <td>Get custom color</td>
                                    </tr>
                                    <tr>
                                        <td><code>feature_enabled?(feature)</code></td>
                                        <td>Check if feature is enabled</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <h6 class="mt-4">Layout Helpers</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Function</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>partial(name, locals)</code></td>
                                        <td>Render partial template</td>
                                    </tr>
                                    <tr>
                                        <td><code>card(title, options, &block)</code></td>
                                        <td>Generate card with content</td>
                                    </tr>
                                    <tr>
                                        <td><code>custom_style(element)</code></td>
                                        <td>Apply custom styling</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-3 p-3 bg-info bg-opacity-10 rounded">
                            <small><i class="fas fa-info-circle text-info me-2"></i>
                            <strong>Pro Tip:</strong> Use <code>custom_css_variables</code> in your layout to dynamically generate CSS variables from your customizations.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Customization Values Tab -->
    <div class="tab-pane fade" id="customization" role="tabpanel">
        <div class="admin-card">
            <div class="admin-card-header">
                <i class="fas fa-cog me-2"></i>
                Using Custom Values in Templates
            </div>
            <div class="admin-card-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <h6>Accessing Custom Values</h6>
                        <p>Use the <code>custom()</code> helper to access values set in the customization interface:</p>
                        
                        <pre class="bg-light p-3 rounded"><code>&lt;%# Get site name %&gt;
&lt;%= custom('branding.site_name', 'Default Name') %&gt;

&lt;%# Get primary color %&gt;
&lt;%= custom_color('primary', '#007bff') %&gt;

&lt;%# Get hero title %&gt;
&lt;%= custom_text('hero_title', 'Welcome') %&gt;</code></pre>

                        <h6 class="mt-4">Available Custom Keys</h6>
                        <div class="accordion" id="customKeysAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#brandingKeys">
                                        Branding Keys
                                    </button>
                                </h2>
                                <div id="brandingKeys" class="accordion-collapse collapse" data-bs-parent="#customKeysAccordion">
                                    <div class="accordion-body">
                                        <ul class="list-unstyled small">
                                            <li><code>branding.site_name</code></li>
                                            <li><code>branding.site_tagline</code></li>
                                            <li><code>branding.company_name</code></li>
                                            <li><code>branding.support_email</code></li>
                                            <li><code>branding.logo_text</code></li>
                                            <li><code>branding.footer_text</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#colorKeys">
                                        Color Keys
                                    </button>
                                </h2>
                                <div id="colorKeys" class="accordion-collapse collapse" data-bs-parent="#customKeysAccordion">
                                    <div class="accordion-body">
                                        <ul class="list-unstyled small">
                                            <li><code>colors.primary</code></li>
                                            <li><code>colors.secondary</code></li>
                                            <li><code>colors.success</code></li>
                                            <li><code>colors.warning</code></li>
                                            <li><code>colors.danger</code></li>
                                            <li><code>colors.background</code></li>
                                            <li><code>colors.navbar_bg</code></li>
                                            <li><code>colors.footer_bg</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6>Dynamic CSS Generation</h6>
                        <p>Generate CSS custom properties from your customizations:</p>
                        
                        <pre class="bg-light p-3 rounded"><code>&lt;style&gt;
&lt;%= custom_css_variables %&gt;

.my-custom-element {
    background-color: var(--custom-primary);
    padding: var(--custom-hero-padding);
}
&lt;/style&gt;</code></pre>

                        <h6 class="mt-4">Conditional Features</h6>
                        <p>Show/hide features based on settings:</p>
                        
                        <pre class="bg-light p-3 rounded"><code>&lt;% if feature_enabled?('show_help_widget') %&gt;
  &lt;div class="help-widget"&gt;
    &lt;!-- Help widget content --&gt;
  &lt;/div&gt;
&lt;% end %&gt;</code></pre>

                        <h6 class="mt-4">Custom Styling</h6>
                        <p>Apply custom styles to elements:</p>
                        
                        <pre class="bg-light p-3 rounded"><code>&lt;section style="&lt;%= custom_style('hero') %&gt;"&gt;
  &lt;!-- Hero content --&gt;
&lt;/section&gt;

&lt;div style="&lt;%= custom_style('card') %&gt;"&gt;
  &lt;!-- Card content --&gt;
&lt;/div&gt;</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Examples Tab -->
    <div class="tab-pane fade" id="examples" role="tabpanel">
        <div class="row g-4">
            <div class="col-12">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <i class="fas fa-code me-2"></i>
                        Template Customization Examples
                    </div>
                    <div class="admin-card-body">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <h6>Example 1: Custom Hero Section</h6>
                                <p class="small text-muted">Customize the homepage hero section with custom text and colors</p>
                                
                                <pre class="bg-light p-3 rounded small"><code>&lt;!-- In views/index.erb --&gt;
&lt;section class="hero-section" style="&lt;%= custom_style('hero') %&gt;"&gt;
    &lt;div class="container"&gt;
        &lt;h1 class="display-4 fw-bold"&gt;
            &lt;%= custom_text('hero_title', 'Default Title') %&gt;
        &lt;/h1&gt;
        &lt;p class="lead"&gt;
            &lt;%= custom_text('hero_subtitle', 'Default subtitle') %&gt;
        &lt;/p&gt;
        
        &lt;% if feature_enabled?('show_trust_indicators') %&gt;
        &lt;div class="trust-indicators"&gt;
            &lt;!-- Trust badges --&gt;
        &lt;/div&gt;
        &lt;% end %&gt;
    &lt;/div&gt;
&lt;/section&gt;</code></pre>
                            </div>
                            
                            <div class="col-lg-6">
                                <h6>Example 2: Custom Navigation</h6>
                                <p class="small text-muted">Customize navigation with brand name and colors</p>
                                
                                <pre class="bg-light p-3 rounded small"><code>&lt;!-- In views/partials/_navigation.erb --&gt;
&lt;nav class="navbar" style="background-color: &lt;%= custom_color('navbar_bg') %&gt;"&gt;
    &lt;div class="container"&gt;
        &lt;a class="navbar-brand" href="/"&gt;
            &lt;i class="fas fa-shield-alt me-2"&gt;&lt;/i&gt;
            &lt;%= custom('branding.logo_text', 'Source License') %&gt;
        &lt;/a&gt;
        
        &lt;!-- Navigation links --&gt;
    &lt;/div&gt;
&lt;/nav&gt;</code></pre>
                            </div>
                            
                            <div class="col-lg-6">
                                <h6>Example 3: Custom Card Component</h6>
                                <p class="small text-muted">Create a reusable card with custom styling</p>
                                
                                <pre class="bg-light p-3 rounded small"><code>&lt;!-- Using the card helper --&gt;
&lt;%= card 'Product Info', class: 'border-primary' do %&gt;
    &lt;p&gt;&lt;%= @product.description %&gt;&lt;/p&gt;
    &lt;div class="price-tag" style="color: &lt;%= custom_color('success') %&gt;"&gt;
        &lt;%= format_currency(@product.price) %&gt;
    &lt;/div&gt;
&lt;% end %&gt;</code></pre>
                            </div>
                            
                            <div class="col-lg-6">
                                <h6>Example 4: Custom Footer</h6>
                                <p class="small text-muted">Footer with custom colors and text</p>
                                
                                <pre class="bg-light p-3 rounded small"><code>&lt;!-- In views/partials/_footer.erb --&gt;
&lt;footer class="footer" style="background-color: &lt;%= custom_color('footer_bg') %&gt;"&gt;
    &lt;div class="container"&gt;
        &lt;p class="text-light"&gt;
            &lt;%= custom('branding.footer_text', 'Default footer text') %&gt;
        &lt;/p&gt;
        &lt;p class="mb-0"&gt;
            © &lt;%= Date.current.year %&gt; 
            &lt;%= custom('branding.company_name', 'Your Company') %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/footer&gt;</code></pre>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-4 bg-success bg-opacity-10 rounded">
                            <h6><i class="fas fa-lightbulb text-success me-2"></i>Best Practices</h6>
                            <ul class="mb-0">
                                <li>Always provide fallback values for custom functions</li>
                                <li>Test your templates after making changes</li>
                                <li>Use semantic CSS classes alongside custom styling</li>
                                <li>Keep templates readable with proper indentation</li>
                                <li>Document your customizations for future reference</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Reference Card -->
<div class="mt-4">
    <div class="admin-card">
        <div class="admin-card-header">
            <i class="fas fa-bookmark me-2"></i>
            Quick Reference
        </div>
        <div class="admin-card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <h6 class="small text-uppercase text-muted">File Locations</h6>
                    <div class="small">
                        <div><code>views/</code> - Templates</div>
                        <div><code>lib/customization.rb</code> - Logic</div>
                        <div><code>config/customizations.yml</code> - Settings</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <h6 class="small text-uppercase text-muted">Key Helpers</h6>
                    <div class="small">
                        <div><code>custom(key, default)</code></div>
                        <div><code>custom_color(name)</code></div>
                        <div><code>feature_enabled?(name)</code></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <h6 class="small text-uppercase text-muted">Admin Routes</h6>
                    <div class="small">
                        <div><code>/admin/customize</code></div>
                        <div><code>/admin/customize/preview</code></div>
                        <div><code>/admin/customize/code-guide</code></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <h6 class="small text-uppercase text-muted">Need Help?</h6>
                    <div class="small">
                        <a href="mailto:<%= ENV['ADMIN_EMAIL'] || 'support@example.com' %>" class="text-decoration-none">
                            <i class="fas fa-envelope me-1"></i>Email Support
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Minimal Contrast Fixes - Maintain Admin Theme -->
<style>
/* Only fix specific white-on-white text issues without changing overall styling */
#guideTabContent .tab-pane h6,
#guideTabContent .tab-pane p,
#guideTabContent .tab-pane li {
    color: var(--bs-body-color, #212529);
}

#guideTabContent .tab-pane .table th,
#guideTabContent .tab-pane .table td {
    color: var(--bs-body-color, #212529);
}

#guideTabContent .tab-pane .accordion-body {
    color: var(--bs-body-color, #212529);
}

#guideTabContent .tab-pane .list-group-item {
    color: var(--bs-body-color, #212529);
}

/* Match code blocks to admin theme */
#guideTabContent .tab-pane pre.bg-light {
    background-color: var(--bs-gray-800, #343a40) !important;
    color: var(--bs-gray-100, #f8f9fa);
    border: 1px solid var(--bs-gray-700, #495057);
}

#guideTabContent .tab-pane pre.bg-light code {
    color: var(--bs-gray-100, #f8f9fa);
}
</style>
