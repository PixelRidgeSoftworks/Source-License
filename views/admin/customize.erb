<!-- Customization Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">Template Customization</h1>
        <p class="text-muted mb-0">Customize colors, text, layout, and features through this visual editor</p>
    </div>
    <div>
        <div class="btn-group">
            <button class="btn btn-outline-primary" onclick="openPreview()">
                <i class="fas fa-eye me-2"></i>Preview Changes
            </button>
            <button class="btn btn-outline-info" onclick="location.href='/admin/customize/code-guide'">
                <i class="fas fa-code me-2"></i>Code Guide
            </button>
            <div class="btn-group">
                <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fas fa-cog me-2"></i>Actions
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#" onclick="exportCustomizations()">
                        <i class="fas fa-download me-2"></i>Export Settings
                    </a></li>
                    <li><a class="dropdown-item" href="#" onclick="showImportModal()">
                        <i class="fas fa-upload me-2"></i>Import Settings
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-warning" href="#" onclick="resetToDefaults()">
                        <i class="fas fa-undo me-2"></i>Reset to Defaults
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Customization Categories -->
<div class="row g-4">
    <% @categories.each do |category_id, category| %>
    <div class="col-lg-6 col-xl-4">
        <div class="admin-card category-card" data-category="<%= category_id %>">
            <div class="admin-card-header">
                <i class="<%= category['icon'] %> me-2"></i>
                <%= category['title'] %>
            </div>
            <div class="admin-card-body">
                <p class="text-muted mb-3"><%= category['description'] %></p>
                <button class="btn btn-primary w-100" onclick="openCategory('<%= category_id %>')">
                    <i class="fas fa-edit me-2"></i>Customize
                </button>
            </div>
        </div>
    </div>
    <% end %>
</div>

<!-- Customization Modal -->
<div class="modal fade" id="customizationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-palette me-2"></i>
                    <span id="modalTitle">Customize</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="customizationForm">
                    <!-- Dynamic form content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveCustomizations()">
                    <i class="fas fa-save me-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-upload me-2"></i>
                    Import Customizations
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="importForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="importFile" class="form-label">Select YAML file to import:</label>
                        <input type="file" class="form-control" id="importFile" name="file" accept=".yml,.yaml" required>
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> Importing will overwrite all current customizations.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="importCustomizations()">
                    <i class="fas fa-upload me-2"></i>Import
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Store customizations data for JavaScript -->
<script>
window.customizations = <%= json_for_js(@customizations) %>;
window.categories = <%= json_for_js(@categories) %>;
</script>

<!-- Customization JavaScript -->
<script>
let currentCategory = null;
let modifiedFields = {};

// Open category for editing
function openCategory(categoryId) {
    currentCategory = categoryId;
    const category = window.categories[categoryId];
    const categoryData = window.customizations[categoryId] || {};

    document.getElementById('modalTitle').textContent = category.title;

    // Generate form fields based on category
    const formHtml = generateCategoryForm(categoryId, categoryData);
    document.getElementById('customizationForm').innerHTML = formHtml;

    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('customizationModal'));
    modal.show();

    // Initialize color pickers and other widgets
    initializeFormWidgets();
}

// Generate form HTML for a category
function generateCategoryForm(categoryId, data) {
    let html = '';

    switch(categoryId) {
        case 'branding':
            html = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Site Name</label>
                        <input type="text" class="form-control" name="site_name" value="${data.site_name || ''}" placeholder="Source License">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Site Tagline</label>
                        <input type="text" class="form-control" name="site_tagline" value="${data.site_tagline || ''}" placeholder="Professional Software Licensing Made Simple">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Company Name</label>
                        <input type="text" class="form-control" name="company_name" value="${data.company_name || ''}" placeholder="Your Company">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Support Email</label>
                        <input type="email" class="form-control" name="support_email" value="${data.support_email || ''}" placeholder="support@example.com">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Logo Text</label>
                        <input type="text" class="form-control" name="logo_text" value="${data.logo_text || ''}" placeholder="Source License">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Footer Text</label>
                        <textarea class="form-control" name="footer_text" rows="2" placeholder="Professional software licensing management system.">${data.footer_text || ''}</textarea>
                    </div>
                </div>
            `;
            break;

        case 'colors':
            html = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Primary Color</label>
                        <input type="color" class="form-control form-control-color" name="primary" value="${data.primary || '#2c3e50'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Secondary Color</label>
                        <input type="color" class="form-control form-control-color" name="secondary" value="${data.secondary || '#3498db'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Success Color</label>
                        <input type="color" class="form-control form-control-color" name="success" value="${data.success || '#27ae60'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Warning Color</label>
                        <input type="color" class="form-control form-control-color" name="warning" value="${data.warning || '#f39c12'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Danger Color</label>
                        <input type="color" class="form-control form-control-color" name="danger" value="${data.danger || '#e74c3c'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Background Color</label>
                        <input type="color" class="form-control form-control-color" name="background" value="${data.background || '#f8f9fa'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Navbar Background</label>
                        <input type="color" class="form-control form-control-color" name="navbar_bg" value="${data.navbar_bg || '#ffffff'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Footer Background</label>
                        <input type="color" class="form-control form-control-color" name="footer_bg" value="${data.footer_bg || '#2c3e50'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hero Gradient Start</label>
                        <input type="color" class="form-control form-control-color" name="hero_gradient_start" value="${data.hero_gradient_start || '#2c3e50'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hero Gradient End</label>
                        <input type="color" class="form-control form-control-color" name="hero_gradient_end" value="${data.hero_gradient_end || '#3498db'}">
                    </div>
                </div>
            `;
            break;

        case 'text':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">Homepage Text</h6>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Hero Title</label>
                        <input type="text" class="form-control" name="hero_title" value="${data.hero_title || ''}" placeholder="Professional Software Licensing Made Simple">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Hero Subtitle</label>
                        <textarea class="form-control" name="hero_subtitle" rows="3" placeholder="Secure, reliable, and easy-to-manage software licenses...">${data.hero_subtitle || ''}</textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Features Section Title</label>
                        <input type="text" class="form-control" name="features_title" value="${data.features_title || ''}" placeholder="Why Choose Source License?">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Products Section Title</label>
                        <input type="text" class="form-control" name="products_title" value="${data.products_title || ''}" placeholder="Available Software Products">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Features Section Subtitle</label>
                        <textarea class="form-control" name="features_subtitle" rows="2" placeholder="Built with modern technology and security best practices...">${data.features_subtitle || ''}</textarea>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Products Section Subtitle</label>
                        <textarea class="form-control" name="products_subtitle" rows="2" placeholder="Choose from our selection of professional software solutions...">${data.products_subtitle || ''}</textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">How It Works Title</label>
                        <input type="text" class="form-control" name="how_it_works_title" value="${data.how_it_works_title || ''}" placeholder="How It Works">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Support Section Title</label>
                        <input type="text" class="form-control" name="support_title" value="${data.support_title || ''}" placeholder="Need Help?">
                    </div>

                    <hr class="my-4">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">Cart & Checkout Text</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Cart Title</label>
                        <input type="text" class="form-control" name="cart_title" value="${data.cart_title || ''}" placeholder="Shopping Cart">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Cart Clear Button</label>
                        <input type="text" class="form-control" name="cart_clear_button" value="${data.cart_clear_button || ''}" placeholder="Clear Cart">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Cart Empty Title</label>
                        <input type="text" class="form-control" name="cart_empty_title" value="${data.cart_empty_title || ''}" placeholder="Your Cart is Empty">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Browse Products Button</label>
                        <input type="text" class="form-control" name="cart_browse_products" value="${data.cart_browse_products || ''}" placeholder="Browse Products">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Cart Empty Message</label>
                        <input type="text" class="form-control" name="cart_empty_message" value="${data.cart_empty_message || ''}" placeholder="Browse our products and add items to your cart to get started.">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Order Summary</label>
                        <input type="text" class="form-control" name="cart_order_summary" value="${data.cart_order_summary || ''}" placeholder="Order Summary">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Proceed to Checkout</label>
                        <input type="text" class="form-control" name="cart_proceed_checkout" value="${data.cart_proceed_checkout || ''}" placeholder="Proceed to Checkout">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Checkout Title</label>
                        <input type="text" class="form-control" name="checkout_title" value="${data.checkout_title || ''}" placeholder="Checkout">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Customer Information</label>
                        <input type="text" class="form-control" name="checkout_customer_info" value="${data.checkout_customer_info || ''}" placeholder="Customer Information">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Payment Method</label>
                        <input type="text" class="form-control" name="checkout_payment_method" value="${data.checkout_payment_method || ''}" placeholder="Payment Method">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Secure Checkout</label>
                        <input type="text" class="form-control" name="checkout_secure_title" value="${data.checkout_secure_title || ''}" placeholder="Secure Checkout">
                    </div>

                    <hr class="my-4">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">License Validation Text</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Validation Title</label>
                        <input type="text" class="form-control" name="validate_title" value="${data.validate_title || ''}" placeholder="Validate License">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Validation Button</label>
                        <input type="text" class="form-control" name="validate_button" value="${data.validate_button || ''}" placeholder="Validate License">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Validation Description</label>
                        <textarea class="form-control" name="validate_description" rows="2" placeholder="Enter your license key below to verify its status and validity...">${data.validate_description || ''}</textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">License Key Label</label>
                        <input type="text" class="form-control" name="validate_license_key" value="${data.validate_license_key || ''}" placeholder="License Key">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Key Placeholder</label>
                        <input type="text" class="form-control" name="validate_placeholder" value="${data.validate_placeholder || ''}" placeholder="Enter your license key...">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Valid License Title</label>
                        <input type="text" class="form-control" name="validate_valid_title" value="${data.validate_valid_title || ''}" placeholder="Valid License">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Invalid License Title</label>
                        <input type="text" class="form-control" name="validate_invalid_title" value="${data.validate_invalid_title || ''}" placeholder="Invalid License">
                    </div>

                    <hr class="my-4">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">User Dashboard Text</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Dashboard Welcome</label>
                        <input type="text" class="form-control" name="dashboard_welcome" value="${data.dashboard_welcome || ''}" placeholder="Welcome back">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Dashboard Subtitle</label>
                        <input type="text" class="form-control" name="dashboard_subtitle" value="${data.dashboard_subtitle || ''}" placeholder="Manage your licenses and account settings">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Total Licenses</label>
                        <input type="text" class="form-control" name="dashboard_total_licenses" value="${data.dashboard_total_licenses || ''}" placeholder="Total Licenses">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Active Licenses</label>
                        <input type="text" class="form-control" name="dashboard_active_licenses" value="${data.dashboard_active_licenses || ''}" placeholder="Active Licenses">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Downloads</label>
                        <input type="text" class="form-control" name="dashboard_downloads" value="${data.dashboard_downloads || ''}" placeholder="Downloads">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Quick Actions</label>
                        <input type="text" class="form-control" name="dashboard_quick_actions" value="${data.dashboard_quick_actions || ''}" placeholder="Quick Actions">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Your Licenses</label>
                        <input type="text" class="form-control" name="dashboard_your_licenses" value="${data.dashboard_your_licenses || ''}" placeholder="Your Licenses">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">No Licenses Title</label>
                        <input type="text" class="form-control" name="dashboard_no_licenses_title" value="${data.dashboard_no_licenses_title || ''}" placeholder="No Licenses Found">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Browse Products</label>
                        <input type="text" class="form-control" name="dashboard_browse_products" value="${data.dashboard_browse_products || ''}" placeholder="Browse Products">
                    </div>

                    <hr class="my-4">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">Login Page Text</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Login Title</label>
                        <input type="text" class="form-control" name="login_title" value="${data.login_title || ''}" placeholder="Sign In">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Login Button</label>
                        <input type="text" class="form-control" name="login_button" value="${data.login_button || ''}" placeholder="Sign In">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Email Label</label>
                        <input type="text" class="form-control" name="login_email" value="${data.login_email || ''}" placeholder="Email Address">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Password Label</label>
                        <input type="text" class="form-control" name="login_password" value="${data.login_password || ''}" placeholder="Password">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Create Account</label>
                        <input type="text" class="form-control" name="login_create_account" value="${data.login_create_account || ''}" placeholder="Create Account">
                    </div>
                </div>
            `;
            break;

        case 'layout':
            html = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Hero Section Padding</label>
                        <input type="text" class="form-control" name="hero_padding" value="${data.hero_padding || ''}" placeholder="4rem 0">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Padding</label>
                        <input type="text" class="form-control" name="section_padding" value="${data.section_padding || ''}" placeholder="5rem 0">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Container Max Width</label>
                        <input type="text" class="form-control" name="container_max_width" value="${data.container_max_width || ''}" placeholder="1200px">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Card Border Radius</label>
                        <input type="text" class="form-control" name="card_border_radius" value="${data.card_border_radius || ''}" placeholder="10px">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Button Border Radius</label>
                        <input type="text" class="form-control" name="button_border_radius" value="${data.button_border_radius || ''}" placeholder="25px">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Footer Padding</label>
                        <input type="text" class="form-control" name="footer_padding" value="${data.footer_padding || ''}" placeholder="2rem 0">
                    </div>
                </div>
            `;
            break;

        case 'hero_section':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="enabled" ${data.enabled ? 'checked' : ''}>
                            <label class="form-check-label fw-bold">Enable Hero Section</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Hero Title</label>
                        <input type="text" class="form-control" name="title" value="${data.title || ''}" placeholder="Professional Software Licensing Made Simple">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Hero Subtitle</label>
                        <textarea class="form-control" name="subtitle" rows="3" placeholder="Secure, reliable, and easy-to-manage...">${data.subtitle || ''}</textarea>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Primary Button Text</label>
                        <input type="text" class="form-control" name="cta_primary_text" value="${data.cta_primary_text || ''}" placeholder="Browse Products">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Primary Button Link</label>
                        <input type="text" class="form-control" name="cta_primary_link" value="${data.cta_primary_link || ''}" placeholder="#products">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Secondary Button Text</label>
                        <input type="text" class="form-control" name="cta_secondary_text" value="${data.cta_secondary_text || ''}" placeholder="Create Account">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Secondary Button Link</label>
                        <input type="text" class="form-control" name="cta_secondary_link" value="${data.cta_secondary_link || ''}" placeholder="/register">
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">Trust Indicators</h6>

                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="show_trust_indicators" ${data.show_trust_indicators ? 'checked' : ''}>
                            <label class="form-check-label">Show Trust Indicators</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Indicator 1 Icon</label>
                        <input type="text" class="form-control" name="trust_indicator_1_icon" value="${data.trust_indicator_1_icon || ''}" placeholder="fas fa-shield-alt">
                    </div>
                    <div class="col-md-8">
                        <label class="form-label">Indicator 1 Text</label>
                        <input type="text" class="form-control" name="trust_indicator_1_text" value="${data.trust_indicator_1_text || ''}" placeholder="SSL Secured">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Indicator 2 Icon</label>
                        <input type="text" class="form-control" name="trust_indicator_2_icon" value="${data.trust_indicator_2_icon || ''}" placeholder="fas fa-lock">
                    </div>
                    <div class="col-md-8">
                        <label class="form-label">Indicator 2 Text</label>
                        <input type="text" class="form-control" name="trust_indicator_2_text" value="${data.trust_indicator_2_text || ''}" placeholder="PCI Compliant">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Indicator 3 Icon</label>
                        <input type="text" class="form-control" name="trust_indicator_3_icon" value="${data.trust_indicator_3_icon || ''}" placeholder="fas fa-clock">
                    </div>
                    <div class="col-md-8">
                        <label class="form-label">Indicator 3 Text</label>
                        <input type="text" class="form-control" name="trust_indicator_3_text" value="${data.trust_indicator_3_text || ''}" placeholder="24/7 Support">
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">Visual Elements</h6>

                    <div class="col-md-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="svg_enabled" ${data.svg_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Use SVG Visual (Modern)</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_license_card" ${data.show_license_card ? 'checked' : ''}>
                            <label class="form-check-label">Show License Card (Legacy)</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_background_elements" ${data.show_background_elements ? 'checked' : ''}>
                            <label class="form-check-label">Show Background Elements</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="animation_enabled" ${data.animation_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Enable Animations</label>
                        </div>
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">SVG Customization</h6>
                    <p class="text-muted mb-3">Customize the colors and appearance of the modern SVG visual element</p>

                    <div class="col-md-6">
                        <label class="form-label">Document Background</label>
                        <input type="color" class="form-control form-control-color" name="svg_document_color" value="${data.svg_document_color || '#ffffff'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Document Border</label>
                        <input type="color" class="form-control form-control-color" name="svg_border_color" value="${data.svg_border_color || '#e1e8ed'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Header Section</label>
                        <input type="color" class="form-control form-control-color" name="svg_header_color" value="${data.svg_header_color || '#f8fafc'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Text Color</label>
                        <input type="color" class="form-control form-control-color" name="svg_text_color" value="${data.svg_text_color || '#64748b'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">License Key Background</label>
                        <input type="color" class="form-control form-control-color" name="svg_key_background_color" value="${data.svg_key_background_color || '#1e293b'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Status Indicator</label>
                        <input type="color" class="form-control form-control-color" name="svg_status_color" value="${data.svg_status_color || '#10b981'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Accent Color (Shield)</label>
                        <input type="color" class="form-control form-control-color" name="svg_accent_color" value="${data.svg_accent_color || '#3b82f6'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Secondary Color (Key)</label>
                        <input type="color" class="form-control form-control-color" name="svg_secondary_color" value="${data.svg_secondary_color || '#10b981'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Tertiary Color (Lock)</label>
                        <input type="color" class="form-control form-control-color" name="svg_tertiary_color" value="${data.svg_tertiary_color || '#f59e0b'}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Icon Color</label>
                        <input type="color" class="form-control form-control-color" name="svg_icon_color" value="${data.svg_icon_color || '#ffffff'}">
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="svg_show_floating_elements" ${data.svg_show_floating_elements ? 'checked' : ''}>
                            <label class="form-check-label">Show Floating Icons</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="svg_enable_animations" ${data.svg_enable_animations ? 'checked' : ''}>
                            <label class="form-check-label">Enable SVG Animations</label>
                        </div>
                    </div>
                </div>
            `;
            break;

        case 'features_section':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="enabled" ${data.enabled ? 'checked' : ''}>
                            <label class="form-check-label fw-bold">Enable Features Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Title</label>
                        <input type="text" class="form-control" name="title" value="${data.title || ''}" placeholder="Why Choose Source License?">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Columns per Row</label>
                        <select class="form-select" name="columns_per_row">
                            <option value="2" ${data.columns_per_row == 2 ? 'selected' : ''}>2 Columns</option>
                            <option value="3" ${data.columns_per_row == 3 ? 'selected' : ''}>3 Columns</option>
                            <option value="4" ${data.columns_per_row == 4 ? 'selected' : ''}>4 Columns</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Section Subtitle</label>
                        <textarea class="form-control" name="subtitle" rows="2" placeholder="Built with modern technology...">${data.subtitle || ''}</textarea>
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">Features (Configure up to 6 features)</h6>

                    ${[1,2,3,4,5,6].map(i => `
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" name="feature_${i}_enabled" ${data[`feature_${i}_enabled`] ? 'checked' : ''}>
                                        <label class="form-check-label fw-bold">Feature ${i}</label>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Icon Class</label>
                                            <input type="text" class="form-control" name="feature_${i}_icon" value="${data[`feature_${i}_icon`] || ''}" placeholder="fas fa-shield-alt">
                                        </div>
                                        <div class="col-md-8">
                                            <label class="form-label">Title</label>
                                            <input type="text" class="form-control" name="feature_${i}_title" value="${data[`feature_${i}_title`] || ''}" placeholder="Feature Title">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-control" name="feature_${i}_description" rows="2" placeholder="Feature description...">${data[`feature_${i}_description`] || ''}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            break;

        case 'products_section':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="enabled" ${data.enabled ? 'checked' : ''}>
                            <label class="form-check-label fw-bold">Enable Products Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Title</label>
                        <input type="text" class="form-control" name="title" value="${data.title || ''}" placeholder="Available Software Products">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Columns per Row</label>
                        <select class="form-select" name="columns_per_row">
                            <option value="2" ${data.columns_per_row == 2 ? 'selected' : ''}>2 Columns</option>
                            <option value="3" ${data.columns_per_row == 3 ? 'selected' : ''}>3 Columns</option>
                            <option value="4" ${data.columns_per_row == 4 ? 'selected' : ''}>4 Columns</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Section Subtitle</label>
                        <textarea class="form-control" name="subtitle" rows="2" placeholder="Choose from our selection...">${data.subtitle || ''}</textarea>
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">No Products Display</h6>

                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="show_when_no_products" ${data.show_when_no_products ? 'checked' : ''}>
                            <label class="form-check-label">Show Section When No Products Available</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">No Products Title</label>
                        <input type="text" class="form-control" name="no_products_title" value="${data.no_products_title || ''}" placeholder="No Products Available">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">No Products Message</label>
                        <input type="text" class="form-control" name="no_products_message" value="${data.no_products_message || ''}" placeholder="Products are currently being configured...">
                    </div>
                </div>
            `;
            break;

        case 'how_it_works':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="enabled" ${data.enabled ? 'checked' : ''}>
                            <label class="form-check-label fw-bold">Enable How It Works Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Title</label>
                        <input type="text" class="form-control" name="title" value="${data.title || ''}" placeholder="How It Works">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Subtitle</label>
                        <input type="text" class="form-control" name="subtitle" value="${data.subtitle || ''}" placeholder="Get your software license in three simple steps.">
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">Steps</h6>

                    ${[1,2,3].map(i => `
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" name="step_${i}_enabled" ${data[`step_${i}_enabled`] ? 'checked' : ''}>
                                        <label class="form-check-label fw-bold">Step ${i}</label>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Icon Class</label>
                                            <input type="text" class="form-control" name="step_${i}_icon" value="${data[`step_${i}_icon`] || ''}" placeholder="fas fa-shopping-cart">
                                        </div>
                                        <div class="col-md-8">
                                            <label class="form-label">Title</label>
                                            <input type="text" class="form-control" name="step_${i}_title" value="${data[`step_${i}_title`] || ''}" placeholder="Step Title">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-control" name="step_${i}_description" rows="2" placeholder="Step description...">${data[`step_${i}_description`] || ''}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            break;

        case 'support_section':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" name="enabled" ${data.enabled ? 'checked' : ''}>
                            <label class="form-check-label fw-bold">Enable Support Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Title</label>
                        <input type="text" class="form-control" name="title" value="${data.title || ''}" placeholder="Need Help?">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Section Subtitle</label>
                        <input type="text" class="form-control" name="subtitle" value="${data.subtitle || ''}" placeholder="We're here to help you...">
                    </div>

                    <hr class="my-4">
                    <h6 class="text-primary mb-3">Support Cards</h6>

                    ${[1,2].map(i => `
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" name="card_${i}_enabled" ${data[`card_${i}_enabled`] ? 'checked' : ''}>
                                        <label class="form-check-label fw-bold">Support Card ${i}</label>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Icon Class</label>
                                            <input type="text" class="form-control" name="card_${i}_icon" value="${data[`card_${i}_icon`] || ''}" placeholder="fas fa-shield-alt">
                                        </div>
                                        <div class="col-md-8">
                                            <label class="form-label">Title</label>
                                            <input type="text" class="form-control" name="card_${i}_title" value="${data[`card_${i}_title`] || ''}" placeholder="Card Title">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-control" name="card_${i}_description" rows="2" placeholder="Card description...">${data[`card_${i}_description`] || ''}</textarea>
                                        </div>
                                        ${i === 1 ? `
                                            <div class="col-md-6">
                                                <label class="form-label">Button 1 Text</label>
                                                <input type="text" class="form-control" name="card_${i}_button_1_text" value="${data[`card_${i}_button_1_text`] || ''}" placeholder="Button Text">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Button 1 Link</label>
                                                <input type="text" class="form-control" name="card_${i}_button_1_link" value="${data[`card_${i}_button_1_link`] || ''}" placeholder="/validate-license">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Button 2 Text</label>
                                                <input type="text" class="form-control" name="card_${i}_button_2_text" value="${data[`card_${i}_button_2_text`] || ''}" placeholder="Button Text">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Button 2 Link</label>
                                                <input type="text" class="form-control" name="card_${i}_button_2_link" value="${data[`card_${i}_button_2_link`] || ''}" placeholder="/login">
                                            </div>
                                        ` : `
                                            <div class="col-md-6">
                                                <label class="form-label">Button Text</label>
                                                <input type="text" class="form-control" name="card_${i}_button_text" value="${data[`card_${i}_button_text`] || ''}" placeholder="Button Text">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Button Link</label>
                                                <input type="text" class="form-control" name="card_${i}_button_link" value="${data[`card_${i}_button_link`] || ''}" placeholder="mailto:support@example.com">
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            break;

        case 'page_structure':
            html = `
                <div class="row g-3">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">Section Visibility</h6>
                        <p class="text-muted mb-3">Control which sections appear on the homepage</p>
                    </div>

                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="hero_enabled" ${data.hero_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Hero Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="features_enabled" ${data.features_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Features Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="products_enabled" ${data.products_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Products Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="how_it_works_enabled" ${data.how_it_works_enabled ? 'checked' : ''}>
                            <label class="form-check-label">How It Works Section</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="support_enabled" ${data.support_enabled ? 'checked' : ''}>
                            <label class="form-check-label">Support Section</label>
                        </div>
                    </div>

                    <hr class="my-4">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">Section Order</h6>
                        <p class="text-muted mb-3">Drag sections to reorder them (coming soon)</p>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Section reordering will be available in a future update. Current order: Hero → Features → Products → How It Works → Support
                        </div>
                    </div>
                </div>
            `;
            break;

        case 'advanced':
            html = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_hero_animation" ${data.show_hero_animation ? 'checked' : ''}>
                            <label class="form-check-label">Show Hero Animation</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_trust_indicators" ${data.show_trust_indicators ? 'checked' : ''}>
                            <label class="form-check-label">Show Trust Indicators</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_help_widget" ${data.show_help_widget ? 'checked' : ''}>
                            <label class="form-check-label">Show Help Widget</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="enable_auto_refresh" ${data.enable_auto_refresh ? 'checked' : ''}>
                            <label class="form-check-label">Enable Auto Refresh</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_version_info" ${data.show_version_info ? 'checked' : ''}>
                            <label class="form-check-label">Show Version Info</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="enable_dark_mode" ${data.enable_dark_mode ? 'checked' : ''}>
                            <label class="form-check-label">Enable Dark Mode</label>
                        </div>
                    </div>
                </div>
            `;
            break;
    }

    return html;
}

// Initialize form widgets (color pickers, etc.)
function initializeFormWidgets() {
    // Add event listeners to track changes
    const formElements = document.querySelectorAll('#customizationForm input, #customizationForm textarea');
    formElements.forEach(element => {
        element.addEventListener('change', function() {
            modifiedFields[this.name] = this.type === 'checkbox' ? this.checked : this.value;
        });
    });
}

// Save customizations
function saveCustomizations() {
    if (Object.keys(modifiedFields).length === 0) {
        AdminUtils.showNotification('No changes to save', 'info');
        return;
    }

    // Prepare updates with category prefix
    const updates = {};
    Object.keys(modifiedFields).forEach(field => {
        updates[`${currentCategory}.${field}`] = modifiedFields[field];
    });

    // Send to server
    fetch('/admin/customize', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(updates)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            AdminUtils.showNotification(data.message, 'success');

            // Update local data
            Object.keys(modifiedFields).forEach(field => {
                if (!window.customizations[currentCategory]) {
                    window.customizations[currentCategory] = {};
                }
                window.customizations[currentCategory][field] = modifiedFields[field];
            });

            // Reset modified fields
            modifiedFields = {};

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('customizationModal'));
            modal.hide();
        } else {
            AdminUtils.showNotification(data.error || 'Save failed', 'danger');
        }
    })
    .catch(error => {
        AdminUtils.showNotification('Network error: ' + error.message, 'danger');
    });
}

// Export customizations
function exportCustomizations() {
    window.open('/admin/customize/export', '_blank');
}

// Show import modal
function showImportModal() {
    const modal = new bootstrap.Modal(document.getElementById('importModal'));
    modal.show();
}

// Import customizations
function importCustomizations() {
    const formData = new FormData(document.getElementById('importForm'));

    fetch('/admin/customize/import', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            AdminUtils.showNotification(data.message, 'success');

            // Close modal and reload page
            const modal = bootstrap.Modal.getInstance(document.getElementById('importModal'));
            modal.hide();

            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            AdminUtils.showNotification(data.error || 'Import failed', 'danger');
        }
    })
    .catch(error => {
        AdminUtils.showNotification('Network error: ' + error.message, 'danger');
    });
}

// Reset to defaults
function resetToDefaults() {
    if (!AdminUtils.confirmAction('Are you sure you want to reset all customizations to defaults? This cannot be undone.')) {
        return;
    }

    fetch('/admin/customize/reset', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            AdminUtils.showNotification(data.message, 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            AdminUtils.showNotification(data.error || 'Reset failed', 'danger');
        }
    })
    .catch(error => {
        AdminUtils.showNotification('Network error: ' + error.message, 'danger');
    });
}

// Open preview in new window
function openPreview() {
    window.open('/admin/customize/preview', '_blank');
}
</script>

<!-- Custom Styles -->
<style>
.category-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

.category-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-color: var(--accent-primary);
}

.form-control-color {
    width: 100%;
    height: 38px;
}

.form-check-input:checked {
    background-color: var(--accent-primary);
    border-color: var(--accent-primary);
}

/* Modal styling - consistent with dark theme */
#customizationModal .modal-content,
#importModal .modal-content {
    background-color: var(--surface-secondary);
    border: 1px solid var(--border-default);
    color: var(--text-primary);
}

#customizationModal .modal-header,
#importModal .modal-header {
    background-color: var(--surface-tertiary);
    border-bottom: 1px solid var(--border-default);
    color: var(--text-primary);
}

#customizationModal .modal-footer,
#importModal .modal-footer {
    background-color: var(--surface-tertiary);
    border-top: 1px solid var(--border-default);
}

#customizationModal .modal-body,
#importModal .modal-body {
    background-color: var(--surface-secondary);
    color: var(--text-primary);
}

#customizationModal .form-label,
#importModal .form-label {
    color: var(--text-primary) !important;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

#customizationModal .form-control,
#customizationModal .form-select,
#importModal .form-control {
    background-color: var(--surface-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
}

#customizationModal .form-control:focus,
#customizationModal .form-select:focus,
#importModal .form-control:focus {
    background-color: var(--surface-secondary);
    color: var(--text-primary);
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 0.25rem rgba(35, 134, 54, 0.25);
}

#customizationModal .form-check-label,
#importModal .form-check-label {
    color: var(--text-primary) !important;
    margin-left: 0.5rem;
}

#customizationModal .form-check-input,
#importModal .form-check-input {
    background-color: var(--surface-tertiary);
    border: 1px solid var(--border-default);
}

#customizationModal .form-check-input:checked,
#importModal .form-check-input:checked {
    background-color: var(--accent-primary);
    border-color: var(--accent-primary);
}

#customizationModal input[type="color"] {
    background-color: var(--surface-tertiary);
    border: 1px solid var(--border-default);
    padding: 2px;
}

/* Dropdown menus in modals */
#customizationModal .dropdown-menu,
#importModal .dropdown-menu {
    background-color: var(--surface-secondary);
    border: 1px solid var(--border-default);
}

#customizationModal .dropdown-item,
#importModal .dropdown-item {
    color: var(--text-primary);
}

#customizationModal .dropdown-item:hover,
#importModal .dropdown-item:hover {
    background-color: var(--surface-tertiary);
    color: var(--accent-primary);
}

/* Import modal alert styling */
#importModal .alert-warning {
    background-color: rgba(251, 133, 0, 0.15);
    border-color: rgba(251, 133, 0, 0.25);
    color: var(--bs-warning);
}

/* Text dividers and headings */
#customizationModal h6,
#importModal h6 {
    color: var(--accent-primary);
}

#customizationModal hr,
#importModal hr {
    border-color: var(--border-default);
    opacity: 0.5;
}

/* Button overrides for modals */
#customizationModal .btn-close,
#importModal .btn-close {
    filter: invert(1);
}
</style>
